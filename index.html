<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GATT â€” Global AI Token Tracker</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='16' fill='%23171715'/><text x='50' y='68' font-size='54' font-family='Georgia,serif' font-weight='900' fill='white' text-anchor='middle'>G</text></svg>">
<meta name="description" content="Daily estimates of global AI token consumption by vendor, country, and region. The most complete open dataset tracking AI compute at scale.">
<meta property="og:type" content="website">
<meta property="og:title" content="Global AI Token Tracker â€” Daily Estimates">
<meta property="og:description" content="China vs US vs World. Daily token consumption estimates from 30+ AI vendors. Updated 2026-02-26.">
<meta property="og:url" content="https://gf691271.github.io/ai-token-tracker/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Global AI Token Tracker">
<meta name="twitter:description" content="By token count, China leads. By compute value, US leads. The data behind the gap.">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root {
  --bg: #f7f6f3;
  --surface: #ffffff;
  --border: #e6e3dc;
  --text: #171715;
  --muted: #6f6d67;
  --subtle: #b5b2ac;
  --cn: #c0392b;
  --us: #2563eb;
  --row: #5a7a5a;
  --chip: #efece6;
  --radius: 8px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
html, body { background: var(--bg); color: var(--text); font-family: Georgia, 'Times New Roman', serif; font-size: 16px; line-height: 1.6; }

/* â”€â”€ LAYOUT â”€â”€ */
.page { max-width: 900px; margin: 0 auto; padding: 0 24px 80px; }

/* â”€â”€ HEADER â”€â”€ */
.site-header {
  border-bottom: 2px solid var(--text);
  padding: 28px 0 18px;
}
.site-header-row1 {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 16px;
}
.site-header-row2 {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  gap: 16px;
  margin-top: 8px;
  flex-wrap: wrap;
}
.site-title { font-family: -apple-system, sans-serif; line-height: 1.1; }
.site-title-logo {
  display: flex;
  align-items: baseline;
  gap: 0;
  flex-wrap: nowrap;
}
.site-title-abbr {
  font-size: 2.4rem;
  font-weight: 900;
  letter-spacing: -0.02em;
  color: var(--text);
  font-family: 'Georgia', serif;
}
.site-title-sep {
  font-size: 1.6rem;
  font-weight: 300;
  color: var(--subtle);
  margin: 0 10px;
  font-family: -apple-system, sans-serif;
}
.site-title-full {
  font-size: 1.1rem;
  font-weight: 500;
  color: var(--muted);
  letter-spacing: 0.01em;
  font-family: -apple-system, sans-serif;
  align-self: center;
}
.site-headline { font-size: 0.88rem; font-weight: 400; line-height: 1.5; margin-top: 8px; color: var(--muted); font-family: -apple-system, sans-serif; font-style: italic; }
.site-meta { text-align: right; font-family: -apple-system, sans-serif; font-size: 0.78rem; color: var(--muted); white-space: nowrap; flex-shrink: 0; }
.site-meta .updated { font-weight: 600; color: var(--text); }
.live-dot { display: inline-block; width: 7px; height: 7px; background: #22c55e; border-radius: 50%; margin-right: 4px; animation: pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(1.4)} }

/* â”€â”€ LANG TOGGLE â”€â”€ */
.lang-toggle { display: flex; border: 1.5px solid var(--border); border-radius: 6px; overflow: hidden; }
.lang-btn { background: none; border: none; padding: 3px 9px; font-size: 0.72rem; font-weight: 600; cursor: pointer; color: var(--muted); font-family: -apple-system, sans-serif; transition: background 0.15s, color 0.15s; }
.lang-btn.active { background: var(--text); color: #fff; }
.lang-btn:hover:not(.active) { background: var(--chip); }

/* â”€â”€ SECTION LABELS â”€â”€ */
.section-label {
  font-family: -apple-system, sans-serif;
  font-size: 0.7rem;
  font-weight: 700;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: var(--muted);
  border-top: 1px solid var(--border);
  padding-top: 28px;
  margin-top: 40px;
  margin-bottom: 20px;
}

/* â”€â”€ HEADLINE NUMBERS â”€â”€ */
.headline-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1px;
  background: var(--border);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 8px;
}
.headline-card {
  background: var(--surface);
  padding: 20px 18px;
}
.headline-card .hl-label { font-family: -apple-system, sans-serif; font-size: 0.72rem; color: var(--muted); margin-bottom: 6px; }
.headline-card .hl-number {
  font-size: 2.2rem;
  font-weight: 700;
  line-height: 1;
  font-variant-numeric: tabular-nums;
}
.headline-card .hl-number.cn { color: var(--cn); }
.headline-card .hl-number.us { color: var(--us); }
.headline-card .hl-sub { font-family: -apple-system, sans-serif; font-size: 0.73rem; color: var(--muted); margin-top: 5px; }
.headline-card .hl-badge {
  display: inline-block;
  font-family: -apple-system, sans-serif;
  font-size: 0.65rem;
  font-weight: 600;
  padding: 2px 6px;
  border-radius: 3px;
  background: var(--chip);
  color: var(--text);
  margin-top: 6px;
}
.share-row { text-align: right; margin-bottom: 4px; }
.btn-share {
  font-family: -apple-system, sans-serif;
  font-size: 0.75rem;
  font-weight: 600;
  padding: 6px 14px;
  border: 1px solid var(--border);
  border-radius: 4px;
  background: var(--surface);
  cursor: pointer;
  color: var(--text);
  transition: background .15s;
}
.btn-share:hover { background: var(--chip); }

/* â”€â”€ TREND CHART â”€â”€ */
.chart-controls {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
  margin-bottom: 14px;
  font-family: -apple-system, sans-serif;
  font-size: 0.78rem;
}
.toggle-group { display: flex; gap: 4px; }
.toggle-btn {
  padding: 4px 10px;
  border-radius: 4px;
  border: 1px solid var(--border);
  background: var(--surface);
  font-size: 0.75rem;
  font-family: -apple-system, sans-serif;
  cursor: pointer;
  color: var(--muted);
  transition: all .15s;
}
.toggle-btn.active { background: var(--text); color: #fff; border-color: var(--text); }
.toggle-btn.cn-btn.active { background: var(--cn); border-color: var(--cn); color: #fff; }
.toggle-btn.us-btn.active { background: var(--us); border-color: var(--us); color: #fff; }
.toggle-btn.row-btn.active { background: var(--row); border-color: var(--row); color: #fff; }
.ctrl-sep { color: var(--border); margin: 0 4px; }
.ctrl-label { color: var(--muted); font-size: 0.72rem; }
.chart-wrap { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; }
.chart-axis-label { font-family: -apple-system, sans-serif; font-size: 0.7rem; color: var(--muted); margin-bottom: 6px; }
.view-toggle-wrap { display: flex; align-items: center; gap: 8px; margin-left: auto; }
.view-toggle { display: flex; gap: 0; border: 1px solid var(--border); border-radius: 4px; overflow: hidden; }
.view-toggle .toggle-btn { border: none; border-radius: 0; }

/* â”€â”€ RANKING TABLE â”€â”€ */
.rank-header {
  display: grid;
  grid-template-columns: 36px 1fr 110px 110px 80px;
  gap: 8px;
  padding: 6px 12px;
  font-family: -apple-system, sans-serif;
  font-size: 0.7rem;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.06em;
  border-bottom: 1px solid var(--border);
}
.rank-row {
  display: grid;
  grid-template-columns: 36px 1fr 110px 110px 80px;
  gap: 8px;
  padding: 11px 12px;
  border-bottom: 1px solid var(--border);
  align-items: center;
  transition: background .1s;
}
.rank-row:hover { background: var(--chip); }
.rank-row:last-child { border-bottom: none; }
.rank-num { font-family: -apple-system, sans-serif; font-size: 0.82rem; color: var(--muted); font-variant-numeric: tabular-nums; }
.rank-name { font-size: 0.92rem; font-weight: 500; }
.rank-flag { margin-right: 5px; }
.rank-tokens { font-family: -apple-system, sans-serif; font-size: 0.85rem; font-variant-numeric: tabular-nums; }
.rank-bar-wrap { position: relative; height: 6px; background: var(--chip); border-radius: 3px; overflow: hidden; }
.rank-bar-fill { height: 100%; border-radius: 3px; transition: width .5s; }
.rank-confidence { font-family: -apple-system, sans-serif; font-size: 0.72rem; }
.conf-3 { color: #166534; } .conf-2 { color: #92400e; } .conf-1 { color: var(--muted); }
.tier-divider { padding: 8px 12px; font-family: -apple-system, sans-serif; font-size: 0.68rem; font-weight: 700; text-transform: uppercase; letter-spacing: .1em; color: var(--muted); background: var(--chip); border-bottom: 1px solid var(--border); }
.range-badge { font-size: 0.72rem; color: var(--muted); font-family: -apple-system, sans-serif; }
.dark-row { opacity: 0.55; }

/* â”€â”€ METHODOLOGY â”€â”€ */
.method-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px 20px;
  font-size: 0.88rem;
  line-height: 1.7;
}
.method-box h3 { font-size: 0.9rem; font-family: -apple-system, sans-serif; font-weight: 700; margin-bottom: 10px; }
.method-box p { color: var(--muted); margin-bottom: 8px; }
.method-box code { font-size: 0.82rem; background: var(--chip); padding: 1px 5px; border-radius: 3px; }

/* â”€â”€ AGENT API â”€â”€ */
.api-box {
  background: #0f0f0e;
  color: #e8e5df;
  border-radius: var(--radius);
  padding: 20px;
  font-family: 'Courier New', monospace;
  font-size: 0.78rem;
  line-height: 1.7;
  overflow-x: auto;
}
.api-comment { color: #5a5a52; }
.api-key { color: #7cb8f2; }
.api-val { color: #98d982; }
.api-str { color: #f0b96a; }

/* â”€â”€ FOOTER â”€â”€ */
.site-footer {
  border-top: 1px solid var(--border);
  margin-top: 48px;
  padding-top: 18px;
  font-family: -apple-system, sans-serif;
  font-size: 0.72rem;
  color: var(--muted);
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 8px;
}

@media (max-width: 640px) {
  .headline-grid { grid-template-columns: 1fr 1fr; }
  .rank-header, .rank-row { grid-template-columns: 28px 1fr 90px 70px; }
  .rank-header > *:nth-child(4), .rank-row > *:nth-child(4) { display: none; }
  .site-title-abbr { font-size: 1.8rem; }
  .site-title-full { font-size: 0.9rem; }
  .site-headline { font-size: 0.82rem; }
}
</style>
</head>
<body>
<div class="page">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<header class="site-header">
  <!-- Row 1: logo line + lang toggle -->
  <div class="site-header-row1">
    <div class="site-title-logo">
      <span class="site-title-abbr">GATT</span>
      <span class="site-title-sep">Â·</span>
      <span class="site-title-full">Global AI Token Tracker</span>
    </div>
    <div class="lang-toggle">
      <button class="lang-btn active" id="btn-en" onclick="setLang('en')">EN</button>
      <button class="lang-btn" id="btn-zh" onclick="setLang('zh')">ä¸­</button>
    </div>
  </div>
  <!-- Row 2: tagline full width -->
  <div style="margin-top:8px;">
    <h1 class="site-headline" id="tagline">The open index tracking the global Token Economy â€” AI inference as commodity, currency, and geopolitical force.</h1>
  </div>
  <!-- Row 3: date + stats right-aligned -->
  <div style="display:flex;justify-content:flex-end;margin-top:10px;gap:16px;align-items:center;">
    <div class="site-meta">
      <span class="live-dot"></span><span class="updated" id="header-date">Updated 2026-02-26</span>
      &nbsp;&nbsp;
      <span id="stat-vendors">29</span> <span class="i18n" data-en="Vendors" data-zh="å‚å•†">Vendors</span> &nbsp;Â·&nbsp;
      <span id="stat-countries">12</span> <span class="i18n" data-en="Countries" data-zh="å›½å®¶">Countries</span> &nbsp;Â·&nbsp;
      <span id="stat-models">80+</span> <span class="i18n" data-en="Models" data-zh="æ¨¡å‹">Models</span>
    </div>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEADLINE NUMBERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-label">Key Numbers â€” Feb 26, 2026</div>
<div class="headline-grid">
  <div class="headline-card">
    <div class="hl-label">Global daily tokens</div>
    <div class="hl-number">~100T</div>
    <div class="hl-sub">trillion tokens / day</div>
    <div class="hl-badge">+417Ã— in 18 months (Doubao)</div>
  </div>
  <div class="headline-card">
    <div class="hl-label">China share by volume</div>
    <div class="hl-number cn">55%</div>
    <div class="hl-sub">~55T tokens/day</div>
    <div class="hl-badge">but only ~14% by compute value</div>
  </div>
  <div class="headline-card">
    <div class="hl-label">US compute value lead</div>
    <div class="hl-number us">$35M</div>
    <div class="hl-sub">DEC / day (OpenAI alone: $32.5M)</div>
    <div class="hl-badge">DEC = Dollar-Equivalent Compute</div>
  </div>
  <div class="headline-card">
    <div class="hl-label">Fastest-growing vendor</div>
    <div class="hl-number cn" style="font-size:1.7rem">Doubao</div>
    <div class="hl-sub">120B/day â†’ 50T/day in 18 months</div>
    <div class="hl-badge">ByteDance Â· ğŸ‡¨ğŸ‡³</div>
  </div>
  <div class="headline-card">
    <div class="hl-label">Data dark zone</div>
    <div class="hl-number" style="color:#6f6d67">11</div>
    <div class="hl-sub">vendors with zero public data</div>
    <div class="hl-badge">incl. Grok, Hunyuan, local inference</div>
  </div>
  <div class="headline-card">
    <div class="hl-label">Confirmed sources</div>
    <div class="hl-number" style="color:#166534">11</div>
    <div class="hl-sub">vendors with verified data</div>
    <div class="hl-badge">earnings / official announcements</div>
  </div>
</div>
<div class="share-row">
  <button class="btn-share" onclick="shareStats()">â†— Share these numbers</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TREND CHART â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-label">Daily Trend â€” Token Consumption Over Time</div>
<div class="chart-controls">
  <span class="ctrl-label">Show:</span>
  <div class="toggle-group">
    <button class="toggle-btn cn-btn active" id="btn-cn" onclick="toggleSeries('cn')">ğŸ‡¨ğŸ‡³ China</button>
    <button class="toggle-btn us-btn active" id="btn-us" onclick="toggleSeries('us')">ğŸ‡ºğŸ‡¸ US</button>
    <button class="toggle-btn row-btn active" id="btn-row" onclick="toggleSeries('row')">ğŸŒ Rest of World</button>
  </div>
  <span class="ctrl-sep">|</span>
  <div class="view-toggle-wrap">
    <span class="ctrl-label">View:</span>
    <div class="view-toggle">
      <button class="toggle-btn active" id="view-tokens" onclick="setView('tokens')">T Tokens</button>
      <button class="toggle-btn" id="view-dec" onclick="setView('dec')">DEC ($M)</button>
    </div>
  </div>
</div>
<div class="chart-wrap">
  <div class="chart-axis-label">Trillion tokens per day (T)</div>
  <canvas id="trendChart" height="260"></canvas>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RANKING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-label">Vendor Ranking â€” Daily Tokens</div>
<div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;" id="rankTable">
  <div class="rank-header">
    <div>#</div><div>Vendor</div><div>T Tokens/day</div><div>DEC $/day</div><div>Source</div>
  </div>
  <!-- rows injected by JS -->
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• METHODOLOGY â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-label">Methodology â€” How We Estimate</div>
<div class="method-box">
  <h3>The Daily Estimation Model</h3>
  <p>No single source publishes daily token counts. This tracker synthesizes five evidence layers to produce daily-granularity estimates:</p>
  <p><strong>1. Anchor events</strong> â€” Official disclosures (earnings calls, press releases, developer conferences) provide point-in-time snapshots.</p>
  <p><strong>2. Growth interpolation</strong> â€” Between anchors, we apply compound daily growth rates derived from public revenue trends, model release cadence, and platform activity signals.</p>
  <p><strong>3. Revenue back-calculation</strong> â€” For vendors with known revenue but no token disclosures, we reverse-engineer volumes using published API pricing.</p>
  <p><strong>4. OpenRouter signal</strong> â€” Platform-level weekly token data provides real-time calibration for API-accessible models.</p>
  <p><strong>5. DEC normalization</strong> â€” <code>DEC = tokens Ã— price_per_1M</code>. This adjusts for tokenizer efficiency differences (Chinese text encodes fewer tokens per character in GPT-style tokenizers vs. native Chinese models). Same data, different scoreboard.</p>
  <p style="margin-top:12px;font-style:italic;color:var(--muted);">The gap between token-count rank and DEC rank is the story: China leads by volume, US leads by compute value. That gap is this tracker's thesis.</p>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AGENT API â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="section-label">For AI Agents â€” Machine-Readable Data Layer</div>
<div class="api-box">
<span class="api-comment">// Fetch structured data â€” zero LLM calls required</span>
GET https://gf691271.github.io/ai-token-tracker/api/v1/tci.json

<span class="api-comment">// Response schema</span>
{
  <span class="api-key">"meta"</span>: { <span class="api-key">"updated"</span>: <span class="api-str">"2026-02-26"</span>, <span class="api-key">"methodology"</span>: <span class="api-str">"DEC = tokens Ã— price/1M"</span> },
  <span class="api-key">"summary"</span>: {
    <span class="api-key">"global_daily_tokens_T"</span>: <span class="api-val">100</span>,
    <span class="api-key">"china_share_pct"</span>: <span class="api-val">55</span>,
    <span class="api-key">"confirmed_data"</span>: <span class="api-val">11</span>,
    <span class="api-key">"dark_zone"</span>: <span class="api-val">11</span>
  },
  <span class="api-key">"vendors"</span>: [ <span class="api-comment">/* 30 vendors, tier 1/2/3, confidence 0-3 */</span> ]
}

<span class="api-comment">// Confidence scale: 3=earnings/official Â· 2=media Â· 1=estimated Â· 0=unknown</span>
<span class="api-comment">// Tier: 1=confirmed Â· 2=range estimate Â· 3=data dark zone</span>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FOOTER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<footer class="site-footer">
  <div>Global AI Token Tracker Â· Open data Â· <a href="https://github.com/gf691271/ai-token-tracker" style="color:inherit">GitHub</a></div>
  <div>All figures are estimates. Not financial advice. Last updated 2026-02-26.</div>
</footer>

</div><!-- /page -->

<script>
// â”€â”€ TREND DATA (daily interpolation from anchor points) â”€â”€
// Algorithm: compound daily growth between confirmed anchor events
// CN anchors: Doubao 120B/d (2024-05-01), 4T/d (2024-12-01), 12.7T/d (2025-03-01), 16.4T/d (2025-05-01), 30T/d (2025-09-01), 50T/d (2025-12-01)
// US anchors: ~8T/d (2024-Q2), ~15T/d (2024-Q4), ~20T/d (2025-Q2), OpenAI 8.6T+Azure+OpenRouter ~28T/d (2025-10), ~32T/d (2025-12), ~34T/d (2026-02)
// RoW: EU(Mistral) + CA(Cohere) + independents, growing slower

function interpolateDaily(anchors, targetDates) {
  return targetDates.map(d => {
    const t = new Date(d).getTime();
    for (let i = 0; i < anchors.length - 1; i++) {
      const t0 = new Date(anchors[i].date).getTime();
      const t1 = new Date(anchors[i+1].date).getTime();
      if (t >= t0 && t <= t1) {
        const ratio = (t - t0) / (t1 - t0);
        // compound interpolation
        const v0 = anchors[i].v, v1 = anchors[i+1].v;
        return +(v0 * Math.pow(v1/v0, ratio)).toFixed(2);
      }
    }
    if (t < new Date(anchors[0].date).getTime()) return anchors[0].v;
    return anchors[anchors.length-1].v;
  });
}

// Generate daily dates from 2024-05-01 to today
function genDates(start, end) {
  const dates = [];
  let d = new Date(start);
  const e = new Date(end);
  while (d <= e) {
    dates.push(d.toISOString().slice(0,10));
    d.setDate(d.getDate() + 1);
  }
  return dates;
}

const startDate = '2024-05-01';
const todayStr = '2026-02-26';
const allDates = genDates(startDate, todayStr);

// Thin to ~monthly ticks for display, keep all data
const displayDates = allDates.filter((_, i) => i % 30 === 0 || i === allDates.length - 1);

const cnAnchors = [
  {date:'2024-05-01', v:0.12},
  {date:'2024-12-01', v:4},
  {date:'2025-03-01', v:12.7},
  {date:'2025-05-01', v:16.4},
  {date:'2025-09-01', v:30},
  {date:'2025-12-01', v:50},
  {date:'2026-02-26', v:55}
];
const usAnchors = [
  {date:'2024-05-01', v:6},
  {date:'2024-12-01', v:12},
  {date:'2025-03-01', v:17},
  {date:'2025-06-01', v:22},
  {date:'2025-10-01', v:28},
  {date:'2025-12-01', v:31},
  {date:'2026-02-26', v:34}
];
const rowAnchors = [
  {date:'2024-05-01', v:1},
  {date:'2024-12-01', v:2.5},
  {date:'2025-06-01', v:5},
  {date:'2025-12-01', v:9},
  {date:'2026-02-26', v:11}
];

// DEC multipliers (tokens Ã— avg_price/T_tokens â†’ $M/day)
// CN: cheap models ~$0.14/T â†’ DEC = tokens*0.14
// US: premium mix ~$1.06/T â†’ DEC = tokens*1.06
// RoW: ~$0.5/T
const cnDECAnchors = cnAnchors.map(a => ({date:a.date, v:+(a.v*0.14).toFixed(2)}));
const usDECAnchors = usAnchors.map(a => ({date:a.date, v:+(a.v*1.06).toFixed(2)}));
const rowDECAnchors = rowAnchors.map(a => ({date:a.date, v:+(a.v*0.5).toFixed(2)}));

const cnVals = interpolateDaily(cnAnchors, allDates);
const usVals = interpolateDaily(usAnchors, allDates);
const rowVals = interpolateDaily(rowAnchors, allDates);
const cnDECVals = interpolateDaily(cnDECAnchors, allDates);
const usDECVals = interpolateDaily(usDECAnchors, allDates);
const rowDECVals = interpolateDaily(rowDECAnchors, allDates);

// Thin data for chart performance
const stride = 7; // weekly points
const chartDates = allDates.filter((_,i) => i % stride === 0 || i === allDates.length-1);
const chartCN = cnVals.filter((_,i) => i % stride === 0 || i === cnVals.length-1);
const chartUS = usVals.filter((_,i) => i % stride === 0 || i === usVals.length-1);
const chartROW = rowVals.filter((_,i) => i % stride === 0 || i === rowVals.length-1);
const chartCNd = cnDECVals.filter((_,i) => i % stride === 0 || i === cnDECVals.length-1);
const chartUSd = usDECVals.filter((_,i) => i % stride === 0 || i === usDECVals.length-1);
const chartROWd = rowDECVals.filter((_,i) => i % stride === 0 || i === rowDECVals.length-1);

// Format labels: show month/year at first of month
const chartLabels = chartDates.map((d,i) => {
  if (i === chartDates.length-1) return 'Today';
  const dt = new Date(d);
  if (dt.getDate() <= 7) return dt.toLocaleDateString('en-US',{month:'short',year:'2-digit'});
  return '';
});

let currentView = 'tokens'; // 'tokens' | 'dec'
let showCN = true, showUS = true, showROW = true;
let trendChart;

function buildDatasets() {
  const isTok = currentView === 'tokens';
  return [
    {
      label: 'ğŸ‡¨ğŸ‡³ China',
      data: isTok ? chartCN : chartCNd,
      borderColor: '#c0392b',
      backgroundColor: 'rgba(192,57,43,0.06)',
      borderWidth: 2,
      pointRadius: (ctx) => ctx.dataIndex === chartDates.length-1 ? 6 : 0,
      pointBackgroundColor: '#c0392b',
      tension: 0.35,
      fill: false,
      hidden: !showCN
    },
    {
      label: 'ğŸ‡ºğŸ‡¸ US',
      data: isTok ? chartUS : chartUSd,
      borderColor: '#2563eb',
      backgroundColor: 'rgba(37,99,235,0.06)',
      borderWidth: 2,
      pointRadius: (ctx) => ctx.dataIndex === chartDates.length-1 ? 6 : 0,
      pointBackgroundColor: '#2563eb',
      tension: 0.35,
      fill: false,
      hidden: !showUS
    },
    {
      label: 'ğŸŒ Rest of World',
      data: isTok ? chartROW : chartROWd,
      borderColor: '#5a7a5a',
      backgroundColor: 'rgba(90,122,90,0.06)',
      borderWidth: 1.5,
      pointRadius: (ctx) => ctx.dataIndex === chartDates.length-1 ? 5 : 0,
      pointBackgroundColor: '#5a7a5a',
      tension: 0.35,
      fill: false,
      hidden: !showROW
    }
  ];
}

function initChart() {
  const ctx = document.getElementById('trendChart').getContext('2d');
  trendChart = new Chart(ctx, {
    type: 'line',
    data: { labels: chartLabels, datasets: buildDatasets() },
    options: {
      responsive: true,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: {
          display: true,
          position: 'top',
          labels: { font: { family: '-apple-system, sans-serif', size: 11 }, boxWidth: 14, padding: 16 }
        },
        tooltip: {
          backgroundColor: '#fff',
          borderColor: '#e6e3dc',
          borderWidth: 1,
          titleColor: '#171715',
          bodyColor: '#6f6d67',
          titleFont: { family: '-apple-system, sans-serif', size: 11 },
          bodyFont: { family: '-apple-system, sans-serif', size: 11 },
          callbacks: {
            label: ctx => {
              const v = ctx.parsed.y;
              return currentView === 'tokens'
                ? ` ${ctx.dataset.label}: ${v.toFixed(1)}T tokens/day`
                : ` ${ctx.dataset.label}: $${v.toFixed(1)}M DEC/day`;
            }
          }
        }
      },
      scales: {
        x: {
          grid: { color: '#f0ede7' },
          ticks: { font: { family: '-apple-system, sans-serif', size: 10 }, color: '#9a9791', maxRotation: 0 }
        },
        y: {
          grid: { color: '#f0ede7' },
          ticks: {
            font: { family: '-apple-system, sans-serif', size: 10 },
            color: '#9a9791',
            callback: v => currentView === 'tokens' ? v+'T' : '$'+v+'M'
          }
        }
      }
    }
  });
  animateTodayDot();
}

// Blinking today dot
function animateTodayDot() {
  let big = true;
  setInterval(() => {
    if (!trendChart) return;
    trendChart.data.datasets.forEach(ds => {
      ds.pointRadius = (ctx) => ctx.dataIndex === chartDates.length-1 ? (big ? 7 : 4) : 0;
    });
    trendChart.update('none');
    big = !big;
  }, 900);
}

function toggleSeries(region) {
  if (region === 'cn') showCN = !showCN;
  if (region === 'us') showUS = !showUS;
  if (region === 'row') showROW = !showROW;
  document.getElementById('btn-cn').classList.toggle('active', showCN);
  document.getElementById('btn-us').classList.toggle('active', showUS);
  document.getElementById('btn-row').classList.toggle('active', showROW);
  trendChart.data.datasets[0].hidden = !showCN;
  trendChart.data.datasets[1].hidden = !showUS;
  trendChart.data.datasets[2].hidden = !showROW;
  trendChart.update();
}

function setView(v) {
  currentView = v;
  document.getElementById('view-tokens').classList.toggle('active', v === 'tokens');
  document.getElementById('view-dec').classList.toggle('active', v === 'dec');
  document.querySelector('.chart-axis-label').textContent =
    v === 'tokens' ? 'Trillion tokens per day (T)' : 'Dollar-Equivalent Compute â€” $M/day';
  trendChart.data.datasets = buildDatasets();
  trendChart.options.scales.y.ticks.callback = val =>
    v === 'tokens' ? val+'T' : '$'+val+'M';
  trendChart.update();
}

// â”€â”€ RANKING TABLE â”€â”€
const vendors = [
  {rank:1, flag:'ğŸ‡ºğŸ‡¸', name:'Google Gemini', tokens:'33T', tokNum:33, dec:'$2.5M', conf:3, src:'Earnings', country:'US'},
  {rank:2, flag:'ğŸ‡¨ğŸ‡³', name:'å­—èŠ‚è·³åŠ¨ Doubao', tokens:'50T', tokNum:50, dec:'$7.0M', conf:2, src:'Media', country:'CN'},
  {rank:3, flag:'ğŸ‡ºğŸ‡¸', name:'OpenAI', tokens:'13T', tokNum:13, dec:'$32.5M', conf:2, src:'DevDay', country:'US'},
  {rank:4, flag:'ğŸ‡¨ğŸ‡³', name:'é˜¿é‡Œäº‘ Qwen', tokens:'5T', tokNum:5, dec:'$0.7M', conf:2, src:'Earnings', country:'CN'},
  {rank:5, flag:'ğŸ‡¨ğŸ‡³', name:'ç™¾åº¦ ERNIE', tokens:'1.6T', tokNum:1.6, dec:'$0.08M', conf:3, src:'Earnings', country:'CN'},
  {rank:6, flag:'ğŸ‡¨ğŸ‡³', name:'è®¯é£ Spark', tokens:'1.5T', tokNum:1.5, dec:'$0.08M', conf:2, src:'Earnings', country:'CN'},
  {rank:7, flag:'ğŸ‡ºğŸ‡¸', name:'OpenRouter', tokens:'1.0T', tokNum:1.0, dec:'$0.15M', conf:3, src:'Official', country:'US'},
  {rank:8, flag:'ğŸ‡¨ğŸ‡³', name:'MiniMax', tokens:'0.35T', tokNum:0.35, dec:'$0.04M', conf:3, src:'OpenRouter', country:'CN'},
  {rank:9, flag:'ğŸ‡¨ğŸ‡³', name:'æœˆä¹‹æš—é¢ Kimi', tokens:'0.17T', tokNum:0.17, dec:'$0.02M', conf:3, src:'OpenRouter', country:'CN'},
  {rank:10, flag:'ğŸ‡¨ğŸ‡³', name:'æ™ºè°± GLM', tokens:'0.11T', tokNum:0.11, dec:'$0.01M', conf:3, src:'OpenRouter', country:'CN'},
];
const tier2 = [
  {name:'Microsoft Azure', flag:'ğŸ‡ºğŸ‡¸', tokens:'5â€“15T est.', conf:1, src:'Revenue Ã· price'},
  {name:'DeepSeek', flag:'ğŸ‡¨ğŸ‡³', tokens:'5â€“10T est.', conf:1, src:'Market share'},
  {name:'Anthropic', flag:'ğŸ‡ºğŸ‡¸', tokens:'1â€“5T est.', conf:1, src:'Revenue Ã· price'},
  {name:'Mistral', flag:'ğŸ‡ªğŸ‡º', tokens:'launch peak only', conf:1, src:'Blog'},
  {name:'Groq', flag:'ğŸ‡ºğŸ‡¸', tokens:'0.1â€“0.5T est.', conf:1, src:'Estimated'},
  {name:'Perplexity', flag:'ğŸ‡ºğŸ‡¸', tokens:'0.05â€“0.1T est.', conf:1, src:'Query count'},
  {name:'Meta Llama API', flag:'ğŸ‡ºğŸ‡¸', tokens:'growth rate only', conf:0, src:'Statement'},
  {name:'Amazon Bedrock', flag:'ğŸ‡ºğŸ‡¸', tokens:'unknown', conf:0, src:'Revenue known'},
];
const tier3 = [
  {name:'è…¾è®¯ Hunyuan', flag:'ğŸ‡¨ğŸ‡³', reason:'WeChat ecosystem â€” closed'},
  {name:'xAI Grok', flag:'ğŸ‡ºğŸ‡¸', reason:'Private company + X closed'},
  {name:'Ollama (local)', flag:'ğŸŒ', reason:'Local inference â€” never reported'},
  {name:'LM Studio', flag:'ğŸŒ', reason:'Local inference â€” never reported'},
  {name:'NVIDIA NIM', flag:'ğŸ‡ºğŸ‡¸', reason:'Enterprise private deployment'},
  {name:'HuggingFace self-hosted', flag:'ğŸŒ', reason:'Download-and-run, no telemetry'},
  {name:'é›¶ä¸€ä¸‡ç‰© Yi', flag:'ğŸ‡¨ğŸ‡³', reason:'No public disclosure'},
  {name:'é˜¶è·ƒæ˜Ÿè¾° Step', flag:'ğŸ‡¨ğŸ‡³', reason:'No public disclosure'},
  {name:'å•†æ±¤ SenseCore', flag:'ğŸ‡¨ğŸ‡³', reason:'B2B private deployment'},
  {name:'Cohere', flag:'ğŸ‡¨ğŸ‡¦', reason:'Enterprise contracts only'},
  {name:'Together AI', flag:'ğŸ‡ºğŸ‡¸', reason:'No public data'},
];

const maxTok = 50;
function confLabel(c) {
  if (c >= 3) return '<span class="conf-3">âœ“ Verified</span>';
  if (c === 2) return '<span class="conf-2">~ Media</span>';
  if (c === 1) return '<span style="color:var(--muted)">â‰ˆ Estimated</span>';
  return '<span style="color:var(--subtle)">? Unknown</span>';
}

function buildRankTable() {
  const table = document.getElementById('rankTable');
  let html = `<div class="rank-header"><div>#</div><div>Vendor</div><div>T Tokens/day</div><div>DEC $/day</div><div>Source</div></div>`;
  html += `<div class="tier-divider">âœ… Tier 1 â€” Confirmed &amp; Estimated with Data (${vendors.length} vendors)</div>`;
  vendors.forEach(v => {
    const bar = (v.tokNum / maxTok * 100).toFixed(1);
    const col = v.country === 'CN' ? 'var(--cn)' : v.country === 'US' ? 'var(--us)' : 'var(--row)';
    html += `<div class="rank-row">
      <div class="rank-num">${v.rank}</div>
      <div><span class="rank-flag">${v.flag}</span><span class="rank-name">${v.name}</span>
        <div class="rank-bar-wrap" style="margin-top:4px"><div class="rank-bar-fill" style="width:${bar}%;background:${col}"></div></div>
      </div>
      <div class="rank-tokens">${v.tokens}</div>
      <div class="rank-tokens" style="color:var(--muted)">${v.dec}</div>
      <div class="rank-confidence">${confLabel(v.conf)}</div>
    </div>`;
  });
  html += `<div class="tier-divider">ğŸ“Š Tier 2 â€” Range Estimates (${tier2.length} vendors)</div>`;
  tier2.forEach((v,i) => {
    html += `<div class="rank-row dark-row">
      <div class="rank-num">${vendors.length+i+1}</div>
      <div><span class="rank-flag">${v.flag}</span><span class="rank-name">${v.name}</span></div>
      <div class="range-badge">${v.tokens}</div>
      <div class="rank-tokens" style="color:var(--subtle)">â€”</div>
      <div class="rank-confidence">${confLabel(v.conf)}<br><span style="font-size:.65rem;color:var(--subtle)">${v.src}</span></div>
    </div>`;
  });
  html += `<div class="tier-divider">ğŸ•³ï¸ Data Dark Zone â€” ${tier3.length} vendors Â· no public data exists</div>`;
  tier3.forEach(v => {
    html += `<div class="rank-row dark-row" style="opacity:.4">
      <div class="rank-num">â€”</div>
      <div><span class="rank-flag">${v.flag}</span><span class="rank-name">${v.name}</span></div>
      <div class="range-badge" style="color:var(--subtle)">?</div>
      <div style="font-size:.72rem;color:var(--subtle);font-family:sans-serif" class="rank-tokens">?</div>
      <div style="font-size:.68rem;color:var(--subtle);font-family:sans-serif">${v.reason}</div>
    </div>`;
  });
  table.innerHTML = html;
}

// â”€â”€ SHARE â”€â”€
function shareStats() {
  const text = `Global AI Token Tracker â€” Feb 26, 2026\n\nğŸŒ ~100T tokens/day globally\nğŸ‡¨ğŸ‡³ China: 55% by volume (55T/day)\nğŸ‡ºğŸ‡¸ US: leads by compute value ($35M DEC/day)\nğŸ“ˆ Doubao grew 417Ã— in 18 months\n\nhttps://gf691271.github.io/ai-token-tracker/`;
  if (navigator.share) {
    navigator.share({ title: 'Global AI Token Tracker', text, url: 'https://gf691271.github.io/ai-token-tracker/' });
  } else {
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.querySelector('.btn-share');
      btn.textContent = 'âœ“ Copied to clipboard';
      setTimeout(() => btn.textContent = 'â†— Share these numbers', 2000);
    });
  }
}

// â”€â”€ INIT â”€â”€
initChart();
buildRankTable();

// â”€â”€ AUTO DATE â”€â”€
(function() {
  const d = new Date();
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const label = `Updated ${months[d.getMonth()]} ${d.getDate()}, ${d.getFullYear()}`;
  const el = document.getElementById('header-date');
  if (el) el.textContent = label;
})();

// â”€â”€ LANGUAGE TOGGLE â”€â”€
const i18n = {
  en: {
    tagline: 'The most complete open dataset tracking the AI inference economy at scale.',
    'header-date-prefix': 'Updated',
  },
  zh: {
    tagline: 'å…¨çƒ Token ç»æµå¼€æ”¾æŒ‡æ•° â€” è¿½è¸ª AI æ¨ç†ç®—åŠ›ä½œä¸ºå¤§å®—å•†å“ã€è´§å¸ä¸åœ°ç¼˜æ”¿æ²»åŠ›é‡çš„æµåŠ¨ã€‚',
    'header-date-prefix': 'æ›´æ–°äº',
  }
};
let currentLang = 'en';
function setLang(lang) {
  currentLang = lang;
  document.getElementById('btn-en').classList.toggle('active', lang === 'en');
  document.getElementById('btn-zh').classList.toggle('active', lang === 'zh');
  // tagline
  const tg = document.getElementById('tagline');
  if (tg) tg.textContent = i18n[lang].tagline;
  // i18n spans
  document.querySelectorAll('.i18n').forEach(el => {
    el.textContent = el.dataset[lang] || el.dataset.en;
  });
  // section labels and other text â€” basic swap
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.dataset.i18n;
    if (i18n[lang][key]) el.textContent = i18n[lang][key];
  });
}
</script>
</body>
</html>
